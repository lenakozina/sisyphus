<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Sisyphus</title>
		<link rel="stylesheet" href="/study_assets/sisyphus/libs/jquery-ui-1.12.1.custom/jquery-ui.min.css">
		<link rel="stylesheet" href="/study_assets/sisyphus/libs/pure-release-1.0.0/pure-min.css">
		<link rel="stylesheet" href="/study_assets/sisyphus/css/general.css">
		<link rel="stylesheet" href="/study_assets/sisyphus/css/options_2.css">
		<script src="/assets/javascripts/jatos.js"></script>
		<script src="/study_assets/sisyphus/libs/jquery-3.4.0.min.js"></script>
		<script src="/study_assets/sisyphus/libs/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
	</head>
	<body>
		<div id="component">

			<p id="progressbarText"></p>
			<div id="progressbar"></div>
			<div id="error"></div>

			<form id="options2Form">
				<div class="pure-g">

					<div class="pure-u-1-3">
						<p class="form-label">Type of counting results</p>
					</div>
					<div class="pure-u-2-3">
						<div id="countTypeButtonset">
							<input type="radio" id="typeI" name="countType" value="typeI">
							<label for="typeI" role="button">Every move of square</label>
							<input type="radio" id="typeII" name="countType" value="typeII">
							<label for="typeII" role="button">Every specific time</label>
						</div>
					</div>
					<div class="pure-u-1-3">
						<p class="form-label"></p>
					</div>
					<div class="pure-u-1-3">
						<div class="form-item" id="countTypeSlider"></div>
					</div>
					<div class="pure-u-1-3">
						<p class="form-item text" id="countTypeSliderText"></p>
					</div>

					<div class="pure-u-1-3">
						<p class="form-label">Study time</p>
					</div>
					<div class="pure-u-1-3">
						<div class="form-item" id="studyTimeSlider"></div>
					</div>
					<div class="pure-u-1-3">
						<p class="form-item text" id="studyTimeSliderText"></p>
					</div>
					<div class="pure-u-1-3">
						<p class="form-label">Move of square</p>
					</div>
					<div class="pure-u-1-3">
						<div class="form-item" id="squareMoveSlider"></div>
					</div>
					<div class="pure-u-1-3">
						<p class="form-item text" id="squareMoveSliderText"></p>
					</div>
					<div class="pure-u-1-3">
						<p class="form-label">Partial results</p>
					</div>
					<div class="pure-u-1-3">
						<div class="form-item" id="partialResultsSlider"></div>
					</div>
					<div class="pure-u-1-3">
						<p class="form-item text" id="partialResultsSliderText"></p>
					</div>
					<div class="pure-u-1-3">
						<p class="form-label">Show current result</p>
					</div>
					<div class="pure-u-1-3">
						<div class="form-item" id="currentResultSlider"></div>
					</div>
					<div class="pure-u-1-3">
						<p class="form-item text" id="currentResultSliderText"></p>
					</div>

					<div class="pure-u-1-3">
						<p class="form-label">Show distractor</p>
					</div>
					<div class="pure-u-1-3">
						<div class="form-item" id="showDistractorSlider"></div>
					</div>
					<div class="pure-u-1-3">
						<p class="form-item text" id="showDistractorSliderText"></p>
					</div>
					<div class="pure-u-1-3">
						<p class="form-label">How long show distractor?</p>
					</div>
					<div class="pure-u-1-3">
						<div class="form-item" id="howLongDistractorSlider"></div>
					</div>
					<div class="pure-u-1-3">
						<p class="form-item text" id="howLongDistractorSliderText"></p>
					</div>

					<div class="pure-u-1-3">
					</div>
					<div class="pure-u-2-3">
						<input class="ui-widget ui-button ui-state-default ui-corner-all form-item"
							type="submit" value="Next">
					</div>
					
				</div>
			</form>

		</div>
		<script>
			var componentSSD = {};

			$(function() {
				initJQueryUiItems();
			});

			function initJQueryUiItems() {
				$("#countTypeButtonset").buttonset();
				$("#countTypeSlider").slider({
					orientation: "horizontal",
					disabled: true,
					range: false,
					min: 100,
					max: 5000,
					value: 100,
					slide: refreshCountTypeSliderText,
					change: refreshCountTypeSliderText
				});
				$("#countTypeSlider").slider("value", 100);

				$("#studyTimeSlider").slider({
					orientation: "horizontal",
					disabled: false,
					range: false,
					min: 30,
					max: 3600,
					value: 30,
					slide: refreshStudyTimeSliderText,
					change: refreshStudyTimeSliderText
				});
				$("#studyTimeSlider").slider("value", 30);
				$("#partialResultsSlider").slider({
					orientation: "horizontal",
					disabled: false,
					range: false,
					min: 10,
					max: 60,
					value: 10,
					slide: refreshPartialResultsSliderText,
					change: refreshPartialResultsSliderText
				});
				$("#partialResultsSlider").slider("value", 10);
				$("#currentResultSlider").slider({
					orientation: "horizontal",
					disabled: false,
					range: false,
					min: 10,
					max: 100000,
					value: 10,
					slide: refreshCurrentResultSliderText,
					change: refreshCurrentResultSliderText
				});
				$("#currentResultSlider").slider("value", 10);
				$("#squareMoveSlider").slider({
					orientation: "horizontal",
					disabled: false,
					range: false,
					min: 10,
					max: 1000,
					value: 10,
					slide: refreshSquareMoveSliderText,
					change: refreshSquareMoveSliderText
				});
				$("#squareMoveSlider").slider("value", 10);

				var disabled = false;
				var distractors = jatos.studySessionData.options1.distractors;
				if (distractors === "None") {
					disabled = true;
				}
				$("#showDistractorSlider").slider({
					orientation: "horizontal",
					disabled: disabled,
					range: false,
					min: 100,
					max: 2000,
					value: 100,
					slide: refreshShowDistractorSliderText,
					change: refreshShowDistractorSliderText
				});
				$("#showDistractorSlider").slider("value", 100);
				$("#howLongDistractorSlider").slider({
					orientation: "horizontal",
					disabled: disabled,
					range: false,
					min: 100,
					max: 1000,
					value: 100,
					slide: refreshHowLongDistractorSliderText,
					change: refreshHowLongDistractorSliderText
				});
				$("#howLongDistractorSlider").slider("value", 100);
			}

			function refreshCountTypeSliderText() {
				$("#countTypeSliderText").text($("#countTypeSlider").slider("value") + " ms");
			}

			function refreshStudyTimeSliderText() {
				$("#studyTimeSliderText").text($("#studyTimeSlider").slider("value") + " s");
			}

			function refreshPartialResultsSliderText() {
				$("#partialResultsSliderText").text($("#partialResultsSlider").slider("value") + " s");
			}

			function refreshCurrentResultSliderText() {
				$("#currentResultSliderText").text($("#currentResultSlider").slider("value") + " ms");
			}

			function refreshSquareMoveSliderText() {
				var value = $("#squareMoveSlider").slider("value");
				$("#squareMoveSliderText").text(value + " ms");
				$("#currentResultSlider").slider("value", value);
				$("#currentResultSlider").slider("option", "min", value);
			}

			function refreshShowDistractorSliderText() {
				$("#showDistractorSliderText").text($("#showDistractorSlider").slider("value") + " ms");
			}

			function refreshHowLongDistractorSliderText() {
				$("#howLongDistractorSliderText").text($("#howLongDistractorSlider").slider("value") + " ms");
			}

			jatos.onLoad(function() {
				startComponent();
			});

			jatos.onError(function(errorMsg) {
				showError(errorMsg);
			});

			function startComponent() {
				initProgressbar();
				addSubmitEvent();

				$("#countTypeButtonset").change(function() {
					var value = $("#countTypeButtonset :radio:checked").val();
					if (value === "typeII") {
						$("#countTypeSlider").slider("option", "disabled", false);
					} else {
						$("#countTypeSlider").slider("option", "disabled", true);
					}
				});

				$(document).keydown(function(event) {
					if (event.keyCode == 27) {
						var answer = confirm("Do you really want to quit this study?");
						if (answer == true) {
							jatos.abortStudy("Worker decided to abort");
						}
					}
				});
			}

			function initProgressbar() {
				$("#progressbar").progressbar({
					value: jatos.componentPos,
					max: (jatos.componentList.length - 1)
				});
				var progressbarText = "Page " + jatos.componentPos + " of " + (jatos.componentList.length - 1);
				$("#progressbarText").text(progressbarText);
			}

			function addSubmitEvent() {
				$("#options2Form").submit(function(event) {
					event.preventDefault();

					if (!validateForm()) {
						return;
					}

					fillResultData();
					endComponentAndNext();
				});
			}

			function validateForm() {
				if ($("#countTypeButtonset :radio:checked + label").text().length === 0) {
					showError("Please choose the method of counting results!");
					return false;
				}
				return true;
			}

			function fillResultData() {
				componentSSD.type = $("#countTypeButtonset :radio:checked").val();
				componentSSD.typeSlider = $("#countTypeSlider").slider("value");
				componentSSD.studySlider = $("#studyTimeSlider").slider("value");
				componentSSD.squareSlider = $("#squareMoveSlider").slider("value");
				componentSSD.partialSlider = $("#partialResultsSlider").slider("value");
				componentSSD.currentSlider = $("#currentResultSlider").slider("value");
				componentSSD.showDistractorSlider = $("#showDistractorSlider").slider("value");
				componentSSD.howDistractorSlider = $("#howLongDistractorSlider").slider("value");
			}

			function endComponentAndNext() {
				var studySessionData = {options1: jatos.studySessionData.options1, options2: componentSSD, options3: null};
				jatos.studySessionData = studySessionData;
				jatos.startNextComponent();
			}

			function showError(errorMsg) {
				$("#error").html(errorMsg).show();
			}

		</script>
	</body>
</html>